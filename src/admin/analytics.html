<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë°©ë¬¸í†µê³„ - ì€ì¸ìê¸ˆíŒŒíŠ¸ë„ˆìŠ¤</title>
  <link rel="stylesheet" href="../css/dashboard.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="../js/admin-auth.js"></script>
  <style>
    .loading-skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 4px;
    }
    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    .error-message {
      text-align: center;
      padding: 40px;
      color: var(--error);
    }
    .refresh-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--neutral-100);
      border: none;
      border-radius: var(--radius-md);
      font-size: 13px;
      color: var(--neutral-700);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .refresh-btn:hover {
      background: var(--neutral-200);
    }
    .refresh-btn.loading svg {
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      100% { transform: rotate(360deg); }
    }
    .data-list {
      list-style: none;
    }
    .data-list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--neutral-100);
    }
    .data-list-item:last-child {
      border-bottom: none;
    }
    .data-list-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--neutral-700);
    }
    .data-list-value {
      font-size: 14px;
      font-weight: 600;
      color: var(--neutral-800);
    }
    .data-list-badge {
      font-size: 12px;
      padding: 2px 8px;
      background: var(--primary-light);
      color: var(--primary);
      border-radius: 10px;
      margin-left: 8px;
    }
    .progress-bar {
      height: 6px;
      background: var(--neutral-200);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 6px;
    }
    .progress-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.5s ease;
    }
    .last-updated {
      font-size: 12px;
      color: var(--neutral-500);
    }
    /* íˆìŠ¤í† ë¦¬ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
    .section-divider {
      margin: 40px 0 24px;
      padding-top: 24px;
      border-top: 2px solid var(--neutral-200);
    }
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .section-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--neutral-800);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .days-selector {
      display: flex;
      gap: 8px;
    }
    .days-btn {
      padding: 6px 12px;
      border: 1px solid var(--neutral-300);
      background: white;
      border-radius: var(--radius-md);
      font-size: 13px;
      color: var(--neutral-600);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .days-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
    }
    .days-btn.active {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }
    /* íˆìŠ¤í† ë¦¬ í…Œì´ë¸” */
    .history-table-wrapper {
      overflow-x: auto;
      overflow-y: auto;
      max-height: 400px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--neutral-200);
    }
    .history-table thead {
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .history-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    .history-table th {
      background: var(--neutral-50);
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      color: var(--neutral-700);
      border-bottom: 1px solid var(--neutral-200);
      white-space: nowrap;
    }
    .history-table td {
      padding: 12px 16px;
      border-bottom: 1px solid var(--neutral-100);
      color: var(--neutral-700);
    }
    .history-table tr:last-child td {
      border-bottom: none;
    }
    .history-table tr:hover td {
      background: var(--neutral-50);
    }
    .table-value {
      font-weight: 600;
      color: var(--neutral-800);
    }
    .table-empty {
      text-align: center;
      padding: 40px;
      color: var(--neutral-400);
    }
    /* ê¸°ê°„ ë¹„êµ ì¹´ë“œ */
    .compare-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    .compare-card {
      background: white;
      border-radius: var(--radius-lg);
      padding: 20px;
      border: 1px solid var(--neutral-200);
    }
    .compare-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--neutral-700);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .compare-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid var(--neutral-100);
    }
    .compare-row:last-child {
      border-bottom: none;
    }
    .compare-label {
      font-size: 13px;
      color: var(--neutral-600);
    }
    .compare-values {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .compare-current {
      font-size: 14px;
      font-weight: 600;
      color: var(--neutral-800);
    }
    .compare-previous {
      font-size: 12px;
      color: var(--neutral-400);
    }
    .compare-change {
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 4px;
    }
    .compare-change.positive {
      background: rgba(16, 185, 129, 0.1);
      color: #059669;
    }
    .compare-change.negative {
      background: rgba(239, 68, 68, 0.1);
      color: #DC2626;
    }
    /* ëˆ„ì  ì°¨íŠ¸ */
    .cumulative-chart-card {
      background: white;
      border-radius: var(--radius-lg);
      padding: 20px;
      border: 1px solid var(--neutral-200);
      margin-top: 16px;
    }
    .cumulative-chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .cumulative-chart-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--neutral-800);
    }
    .collect-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: var(--primary);
      border: none;
      border-radius: var(--radius-md);
      font-size: 12px;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .collect-btn:hover {
      background: var(--primary-hover);
    }
    .collect-btn:disabled {
      background: var(--neutral-300);
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- ì‚¬ì´ë“œë°” -->
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
    <aside class="sidebar"></aside>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
      <!-- í—¤ë” -->
      <header class="dashboard-header"></header>

      <!-- ê¸°ê°„ ì„ íƒ íƒ­ -->
      <div class="period-tabs">
        <button class="period-tab active" data-period="daily">ì¼ê°„</button>
        <button class="period-tab" data-period="weekly">ì£¼ê°„</button>
        <button class="period-tab" data-period="monthly">ì›”ê°„</button>
      </div>

      <!-- ê¸°ê°„ í‘œì‹œ -->
      <div class="period-range">
        <span class="period-range-label">ğŸ“… ì§‘ê³„ ê¸°ê°„</span>
        <span class="period-range-value" id="period-display">ë¡œë”© ì¤‘...</span>
        <div style="flex:1"></div>
        <button class="refresh-btn" onclick="refreshData()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M23 4v6h-6M1 20v-6h6"/>
            <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
          </svg>
          ìƒˆë¡œê³ ì¹¨
        </button>
      </div>

      <!-- í†µê³„ ì¹´ë“œ -->
      <div class="stats-grid" id="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
          </div>
          <div class="stat-info">
            <div class="stat-label">ë°©ë¬¸ì</div>
            <div class="stat-value" id="stat-visitors">-</div>
            <div class="stat-change" id="stat-visitors-change">ë¡œë”© ì¤‘...</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon icon-page">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
            </svg>
          </div>
          <div class="stat-info">
            <div class="stat-label">í˜ì´ì§€ë·°</div>
            <div class="stat-value" id="stat-pageviews">-</div>
            <div class="stat-change" id="stat-pageviews-change">ë¡œë”© ì¤‘...</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon icon-time">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12,6 12,12 16,14"/>
            </svg>
          </div>
          <div class="stat-info">
            <div class="stat-label">í‰ê·  ì²´ë¥˜ì‹œê°„</div>
            <div class="stat-value" id="stat-duration">-</div>
            <div class="stat-change" id="stat-duration-change">ë¡œë”© ì¤‘...</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon icon-inbox">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
              <polyline points="16,17 21,12 16,7"/>
              <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
          </div>
          <div class="stat-info">
            <div class="stat-label">ì´íƒˆë¥ </div>
            <div class="stat-value" id="stat-bounce">-</div>
            <div class="stat-change" id="stat-bounce-change">ë¡œë”© ì¤‘...</div>
          </div>
        </div>
      </div>

      <!-- ì¶”ì´ ì°¨íŠ¸ (ìµœê·¼ 7ì¼) -->
      <div class="charts-grid analytics-charts">
        <div class="chart-card chart-card-wide">
          <div class="chart-header">
            <h3 class="chart-title" id="chart-title">ì¼ë³„ ë°©ë¬¸ ì¶”ì´ (ìµœê·¼ 7ì¼)</h3>
            <div class="chart-legend">
              <div class="legend-item"><span class="legend-color" style="background:#0066CC"></span>ë°©ë¬¸ì</div>
              <div class="legend-item"><span class="legend-color" style="background:#10B981"></span>í˜ì´ì§€ë·°</div>
            </div>
          </div>
          <div class="chart-body" style="height:200px">
            <canvas id="trendChart"></canvas>
          </div>
        </div>
      </div>

      <!-- ë¶„ì„ ê·¸ë¦¬ë“œ -->
      <div class="charts-grid" style="margin-top:20px">
        <!-- íŠ¸ë˜í”½ ì†ŒìŠ¤ -->
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">ğŸ”— íŠ¸ë˜í”½ ì†ŒìŠ¤</h3>
          </div>
          <ul class="data-list" id="traffic-list">
            <li class="data-list-item">
              <span class="data-list-label loading-skeleton" style="width:100px;height:16px"></span>
              <span class="data-list-value loading-skeleton" style="width:50px;height:16px"></span>
            </li>
          </ul>
        </div>

        <!-- ìœ ì… ê²½ë¡œ (ì°¸ì¡° URL) -->
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">ğŸŒ ìœ ì… ê²½ë¡œ</h3>
          </div>
          <ul class="data-list" id="referrer-list">
            <li class="data-list-item">
              <span class="data-list-label loading-skeleton" style="width:150px;height:16px"></span>
              <span class="data-list-value loading-skeleton" style="width:40px;height:16px"></span>
            </li>
          </ul>
        </div>

        <!-- ê¸°ê¸°ë³„ -->
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">ğŸ“± ê¸°ê¸°ë³„ ì‚¬ìš©ì</h3>
          </div>
          <ul class="data-list" id="devices-list">
            <li class="data-list-item">
              <span class="data-list-label loading-skeleton" style="width:100px;height:16px"></span>
              <span class="data-list-value loading-skeleton" style="width:50px;height:16px"></span>
            </li>
          </ul>
        </div>

        <!-- ì¸ê¸° í˜ì´ì§€ -->
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">ğŸ“„ ì¸ê¸° í˜ì´ì§€</h3>
          </div>
          <ul class="data-list" id="pages-list">
            <li class="data-list-item">
              <span class="data-list-label loading-skeleton" style="width:150px;height:16px"></span>
              <span class="data-list-value loading-skeleton" style="width:40px;height:16px"></span>
            </li>
          </ul>
        </div>

        <!-- ì§€ì—­ë³„ -->
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">ğŸŒ ë°©ë¬¸ ì§€ì—­</h3>
          </div>
          <ul class="data-list" id="geography-list">
            <li class="data-list-item">
              <span class="data-list-label loading-skeleton" style="width:80px;height:16px"></span>
              <span class="data-list-value loading-skeleton" style="width:40px;height:16px"></span>
            </li>
          </ul>
        </div>
      </div>

      <!-- ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ -->
      <div style="text-align:center; margin-top:24px; padding:16px;">
        <span class="last-updated" id="last-updated"></span>
      </div>

      <!-- ========== íˆìŠ¤í† ë¦¬ ì„¹ì…˜ (ì¶”ê°€) ========== -->
      <div class="section-divider" style="margin-bottom: 300px;">
        <div class="section-header">
          <h2 class="section-title">ğŸ“Š ê¸°ê°„ë³„ ëˆ„ì  ë°ì´í„°</h2>
          <div class="days-selector">
            <button class="days-btn active" data-days="7">7ì¼</button>
            <button class="days-btn" data-days="30">30ì¼</button>
            <button class="days-btn" data-days="90">90ì¼</button>
          </div>
        </div>

        <!-- ê¸°ê°„ ë¹„êµ (ì¼ê°„/ì£¼ê°„/ì›”ê°„ í•œëˆˆì—) -->
        <div class="compare-grid" id="compare-grid">
          <div class="compare-card">
            <div class="compare-title">ğŸ“… ì˜¤ëŠ˜ vs ì–´ì œ</div>
            <div id="compare-daily">
              <div class="compare-row">
                <span class="compare-label">ë°©ë¬¸ì</span>
                <div class="compare-values">
                  <span class="compare-current loading-skeleton" style="width:40px;height:16px"></span>
                </div>
              </div>
            </div>
          </div>
          <div class="compare-card">
            <div class="compare-title">ğŸ“† ì´ë²ˆ ì£¼ vs ì§€ë‚œ ì£¼</div>
            <div id="compare-weekly">
              <div class="compare-row">
                <span class="compare-label">ë°©ë¬¸ì</span>
                <div class="compare-values">
                  <span class="compare-current loading-skeleton" style="width:40px;height:16px"></span>
                </div>
              </div>
            </div>
          </div>
          <div class="compare-card">
            <div class="compare-title">ğŸ—“ï¸ ì´ë²ˆ ë‹¬ vs ì§€ë‚œ ë‹¬</div>
            <div id="compare-monthly">
              <div class="compare-row">
                <span class="compare-label">ë°©ë¬¸ì</span>
                <div class="compare-values">
                  <span class="compare-current loading-skeleton" style="width:40px;height:16px"></span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ëˆ„ì  ì¶”ì´ ì°¨íŠ¸ -->
        <div class="cumulative-chart-card">
          <div class="cumulative-chart-header">
            <span class="cumulative-chart-title">ğŸ“ˆ ì¥ê¸° ì¶”ì´ ì°¨íŠ¸</span>
            <span style="font-size:11px; color:var(--neutral-400)">ë§¤ì¼ 01:00 ìë™ ìˆ˜ì§‘</span>
          </div>
          <div style="height:250px">
            <canvas id="historyChart"></canvas>
          </div>
        </div>

        <!-- íˆìŠ¤í† ë¦¬ í…Œì´ë¸” -->
        <div class="cumulative-chart-card" style="margin-top:16px">
          <div class="cumulative-chart-header">
            <span class="cumulative-chart-title">ğŸ“‹ ì¼ë³„ ìƒì„¸ ë°ì´í„°</span>
          </div>
          <div class="history-table-wrapper">
            <table class="history-table">
              <thead>
                <tr>
                  <th>ë‚ ì§œ</th>
                  <th>ë°©ë¬¸ì</th>
                  <th>í˜ì´ì§€ë·°</th>
                  <th>í‰ê·  ì²´ë¥˜</th>
                  <th>ì´íƒˆë¥ </th>
                </tr>
              </thead>
              <tbody id="history-table-body">
                <tr>
                  <td colspan="5" class="table-empty">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </main>
  </div>

  <script src="../js/components.js"></script>
  <script>
    // GA4 Analytics Worker URL
    const GA4_API_URL = 'https://euninbiz.swdoor15.workers.dev';

    // í˜„ì¬ ê¸°ê°„
    let currentPeriod = 'daily';
    let trendChart = null;
    let analyticsData = null;

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      loadSidebar('analytics');
      loadDashboardHeader('ë°©ë¬¸í†µê³„', 'Google Analytics ë°ì´í„°');
      initPeriodTabs();
      loadAnalyticsData();
    });

    // ê¸°ê°„ íƒ­ ì´ˆê¸°í™”
    function initPeriodTabs() {
      const tabs = document.querySelectorAll('.period-tab');
      tabs.forEach(tab => {
        tab.addEventListener('click', function() {
          tabs.forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          currentPeriod = this.dataset.period;
          loadAnalyticsData();
        });
      });
    }

    // ë°ì´í„° ë¡œë“œ
    async function loadAnalyticsData() {
      try {
        showLoading();
        const response = await fetch(`${GA4_API_URL}/analytics/all?period=${currentPeriod}`);

        if (!response.ok) {
          throw new Error('API ìš”ì²­ ì‹¤íŒ¨');
        }

        analyticsData = await response.json();
        renderDashboard(analyticsData);

      } catch (error) {
        console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        showError('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
    }

    // ëŒ€ì‹œë³´ë“œ ë Œë”ë§
    function renderDashboard(data) {
      // ê¸°ê°„ í‘œì‹œ
      if (data.overview && data.overview.period) {
        const { startDate, endDate } = data.overview.period;
        document.getElementById('period-display').textContent =
          `${formatDate(startDate)} ~ ${formatDate(endDate)}`;
      }

      // í†µê³„ ì¹´ë“œ
      if (data.overview) {
        renderOverview(data.overview);
      }

      // ì¶”ì´ ì°¨íŠ¸
      if (data.trend) {
        renderTrendChart(data.trend);
      }

      // íŠ¸ë˜í”½ ì†ŒìŠ¤
      if (data.traffic) {
        renderTrafficSources(data.traffic);
      }

      // ê¸°ê¸°ë³„
      if (data.devices) {
        renderDevices(data.devices);
      }

      // ì¸ê¸° í˜ì´ì§€
      if (data.pages) {
        renderTopPages(data.pages);
      }

      // ì§€ì—­ë³„
      if (data.geography) {
        renderGeography(data.geography);
      }

      // ìœ ì… ê²½ë¡œ
      if (data.referrers) {
        renderReferrers(data.referrers);
      } else {
        // referrers ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° íŠ¸ë˜í”½ ì†ŒìŠ¤ë¡œ ëŒ€ì²´
        document.getElementById('referrer-list').innerHTML =
          '<li class="data-list-item"><span class="data-list-label" style="color:var(--neutral-400)">ìƒì„¸ ìœ ì… ê²½ë¡œëŠ” íŠ¸ë˜í”½ ì†ŒìŠ¤ì—ì„œ í™•ì¸í•˜ì„¸ìš”</span></li>';
      }

      // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸
      document.getElementById('last-updated').textContent =
        `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${new Date().toLocaleString('ko-KR')}`;
    }

    // ê°œìš” í†µê³„ ë Œë”ë§
    function renderOverview(overview) {
      // ë°©ë¬¸ì
      document.getElementById('stat-visitors').textContent =
        overview.visitors.value.toLocaleString() + 'ëª…';
      renderChange('stat-visitors-change', overview.visitors.change);

      // í˜ì´ì§€ë·°
      document.getElementById('stat-pageviews').textContent =
        overview.pageviews.value.toLocaleString() + 'íšŒ';
      renderChange('stat-pageviews-change', overview.pageviews.change);

      // ì²´ë¥˜ì‹œê°„
      document.getElementById('stat-duration').textContent = overview.duration.value;
      renderChange('stat-duration-change', overview.duration.change);

      // ì´íƒˆë¥ 
      document.getElementById('stat-bounce').textContent = overview.bounceRate.value + '%';
      renderChange('stat-bounce-change', overview.bounceRate.change, true);
    }

    // ë³€í™”ìœ¨ í‘œì‹œ
    function renderChange(elementId, change, isReverse = false) {
      const el = document.getElementById(elementId);
      const isPositive = isReverse ? change < 0 : change > 0;
      const sign = change >= 0 ? '+' : '';
      const periodLabel = getPeriodLabel();

      el.textContent = `${sign}${change}% ${periodLabel}`;
      el.className = `stat-change ${isPositive ? 'positive' : 'negative'}`;
    }

    // ê¸°ê°„ ë ˆì´ë¸”
    function getPeriodLabel() {
      switch(currentPeriod) {
        case 'daily': return 'ì „ì¼ ëŒ€ë¹„';
        case 'weekly': return 'ì „ì£¼ ëŒ€ë¹„';
        case 'monthly': return 'ì „ì›” ëŒ€ë¹„';
        default: return '';
      }
    }

    // ì¶”ì´ ì°¨íŠ¸ ë Œë”ë§
    function renderTrendChart(trendData) {
      const ctx = document.getElementById('trendChart').getContext('2d');

      // ì°¨íŠ¸ íƒ€ì´í‹€
      const titleMap = {
        daily: 'ì¼ë³„ ë°©ë¬¸ ì¶”ì´ (ìµœê·¼ 7ì¼)',
        weekly: 'ì£¼ë³„ ë°©ë¬¸ ì¶”ì´',
        monthly: 'ì›”ë³„ ë°©ë¬¸ ì¶”ì´'
      };
      document.getElementById('chart-title').textContent = titleMap[currentPeriod];

      // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
      if (trendChart) {
        trendChart.destroy();
      }

      // ë°ì´í„° ê°€ê³µ (ìµœê·¼ 7ì¼ë§Œ í‘œì‹œ)
      let trendItems = trendData.trend || [];
      if (currentPeriod === 'daily' && trendItems.length > 7) {
        trendItems = trendItems.slice(-7);
      }
      const labels = trendItems.map(item => formatChartDate(item.date));
      const visitors = trendItems.map(item => item.visitors);
      const pageviews = trendItems.map(item => item.pageviews);

      // ìƒˆ ì°¨íŠ¸ ìƒì„±
      trendChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'ë°©ë¬¸ì',
              data: visitors,
              borderColor: '#0066CC',
              backgroundColor: 'rgba(0, 102, 204, 0.1)',
              fill: true,
              tension: 0.4,
              borderWidth: 2,
              pointRadius: 4,
              pointHoverRadius: 6
            },
            {
              label: 'í˜ì´ì§€ë·°',
              data: pageviews,
              borderColor: '#10B981',
              backgroundColor: 'transparent',
              tension: 0.4,
              borderWidth: 2,
              pointRadius: 4,
              pointHoverRadius: 6
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'white',
              titleColor: '#1F2937',
              bodyColor: '#4B5563',
              borderColor: '#E5E7EB',
              borderWidth: 1,
              padding: 12
            }
          },
          scales: {
            x: {
              grid: { display: false },
              ticks: { font: { size: 11 } }
            },
            y: {
              beginAtZero: true,
              grid: { color: '#F3F4F6' },
              ticks: { font: { size: 11 } }
            }
          }
        }
      });
    }

    // íŠ¸ë˜í”½ ì†ŒìŠ¤ ë Œë”ë§
    function renderTrafficSources(trafficData) {
      const list = document.getElementById('traffic-list');

      if (!trafficData.sources || trafficData.sources.length === 0) {
        list.innerHTML = '<li class="data-list-item"><span class="data-list-label">ë°ì´í„° ì—†ìŒ</span></li>';
        return;
      }

      const colorMap = {
        'Direct': '#0066CC',
        'Organic Search': '#10B981',
        'Referral': '#F59E0B',
        'Social': '#8B5CF6',
        'Email': '#EF4444',
        'Paid Search': '#EC4899'
      };

      list.innerHTML = trafficData.sources.map(source => `
        <li class="data-list-item">
          <div style="flex:1">
            <div class="data-list-label">
              <span style="width:8px;height:8px;background:${colorMap[source.source] || '#6B7280'};border-radius:2px"></span>
              ${translateSource(source.source)}
            </div>
            <div class="progress-bar">
              <div class="progress-fill" style="width:${source.percentage}%;background:${colorMap[source.source] || '#6B7280'}"></div>
            </div>
          </div>
          <span class="data-list-value">${source.sessions}íšŒ<span class="data-list-badge">${source.percentage}%</span></span>
        </li>
      `).join('');
    }

    // ê¸°ê¸°ë³„ ë Œë”ë§
    function renderDevices(devicesData) {
      const list = document.getElementById('devices-list');

      if (!devicesData.devices || devicesData.devices.length === 0) {
        list.innerHTML = '<li class="data-list-item"><span class="data-list-label">ë°ì´í„° ì—†ìŒ</span></li>';
        return;
      }

      const iconMap = {
        'mobile': 'ğŸ“±',
        'desktop': 'ğŸ’»',
        'tablet': 'ğŸ“²'
      };

      const colorMap = {
        'mobile': '#0066CC',
        'desktop': '#10B981',
        'tablet': '#F59E0B'
      };

      list.innerHTML = devicesData.devices.map(device => `
        <li class="data-list-item">
          <div style="flex:1">
            <div class="data-list-label">
              ${iconMap[device.device] || 'ğŸ–¥ï¸'} ${translateDevice(device.device)}
            </div>
            <div class="progress-bar">
              <div class="progress-fill" style="width:${device.percentage}%;background:${colorMap[device.device] || '#6B7280'}"></div>
            </div>
          </div>
          <span class="data-list-value">${device.users}ëª…<span class="data-list-badge">${device.percentage}%</span></span>
        </li>
      `).join('');
    }

    // ì¸ê¸° í˜ì´ì§€ ë Œë”ë§
    function renderTopPages(pagesData) {
      const list = document.getElementById('pages-list');

      if (!pagesData.pages || pagesData.pages.length === 0) {
        list.innerHTML = '<li class="data-list-item"><span class="data-list-label">ë°ì´í„° ì—†ìŒ</span></li>';
        return;
      }

      list.innerHTML = pagesData.pages.map((page, idx) => `
        <li class="data-list-item">
          <span class="data-list-label">
            <span style="width:20px;height:20px;background:var(--primary);color:white;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;font-size:11px;font-weight:600">${idx + 1}</span>
            ${translatePage(page.path)}
          </span>
          <span class="data-list-value">${page.views}íšŒ</span>
        </li>
      `).join('');
    }

    // ì§€ì—­ë³„ ë Œë”ë§
    function renderGeography(geoData) {
      const list = document.getElementById('geography-list');

      if (!geoData.regions || geoData.regions.length === 0) {
        list.innerHTML = '<li class="data-list-item"><span class="data-list-label">ë°ì´í„° ì—†ìŒ</span></li>';
        return;
      }

      list.innerHTML = geoData.regions.map(region => `
        <li class="data-list-item">
          <span class="data-list-label">ğŸ“ ${region.city === '(not set)' ? 'ë¯¸í™•ì¸' : region.city}</span>
          <span class="data-list-value">${region.users}ëª…</span>
        </li>
      `).join('');
    }

    // ìœ ì… ê²½ë¡œ ë Œë”ë§
    function renderReferrers(referrersData) {
      const list = document.getElementById('referrer-list');

      if (!referrersData.referrers || referrersData.referrers.length === 0) {
        list.innerHTML = '<li class="data-list-item"><span class="data-list-label">ë°ì´í„° ì—†ìŒ</span></li>';
        return;
      }

      list.innerHTML = referrersData.referrers.map(ref => {
        const sourceName = translateReferrer(ref.source, ref.medium);
        return `
          <li class="data-list-item">
            <div style="flex:1">
              <div class="data-list-label">${sourceName}</div>
              <div style="font-size:11px;color:var(--neutral-400);margin-top:2px">${ref.source} / ${ref.medium}</div>
            </div>
            <span class="data-list-value">${ref.sessions}íšŒ<span class="data-list-badge">${ref.percentage}%</span></span>
          </li>
        `;
      }).join('');
    }

    // ìœ ì… ê²½ë¡œ ë²ˆì—­
    function translateReferrer(source, medium) {
      if (source === '(direct)' && medium === '(none)') return 'ğŸ”— ì§ì ‘ ë°©ë¬¸';
      if (medium === 'organic') return 'ğŸ” ê²€ìƒ‰ ìœ ì… (' + source + ')';
      if (medium === 'referral') return 'ğŸŒ ì™¸ë¶€ ë§í¬ (' + source + ')';
      if (medium === 'social') return 'ğŸ“± ì†Œì…œ (' + source + ')';
      if (medium === 'email') return 'ğŸ“§ ì´ë©”ì¼';
      if (medium === 'cpc' || medium === 'ppc') return 'ğŸ’° ìœ ë£Œ ê´‘ê³  (' + source + ')';
      return 'ğŸ”— ' + source;
    }

    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    function formatDate(dateStr) {
      if (!dateStr) return '';
      const year = dateStr.substring(0, 4);
      const month = dateStr.substring(5, 7);
      const day = dateStr.substring(8, 10);
      return `${year}.${month}.${day}`;
    }

    function formatChartDate(dateStr) {
      if (!dateStr) return '';
      const month = dateStr.substring(4, 6);
      const day = dateStr.substring(6, 8);
      return `${parseInt(month)}/${parseInt(day)}`;
    }

    function translateSource(source) {
      const map = {
        'Direct': 'ì§ì ‘ ë°©ë¬¸',
        'Organic Search': 'ê²€ìƒ‰ ìœ ì…',
        'Referral': 'ì°¸ì¡° ìœ ì…',
        'Social': 'ì†Œì…œ ë¯¸ë””ì–´',
        'Email': 'ì´ë©”ì¼',
        'Paid Search': 'ìœ ë£Œ ê²€ìƒ‰',
        '(none)': 'ì§ì ‘ ë°©ë¬¸'
      };
      return map[source] || source;
    }

    function translateDevice(device) {
      const map = {
        'mobile': 'ëª¨ë°”ì¼',
        'desktop': 'ë°ìŠ¤í¬í†±',
        'tablet': 'íƒœë¸”ë¦¿'
      };
      return map[device] || device;
    }

    function translatePage(path) {
      const map = {
        '/': 'ë©”ì¸ í˜ì´ì§€',
        '/index.html': 'ë©”ì¸ í˜ì´ì§€',
        '/service.html': 'ì„œë¹„ìŠ¤ ì†Œê°œ',
        '/service': 'ì„œë¹„ìŠ¤ ì†Œê°œ',
        '/process.html': 'ì§„í–‰ í”„ë¡œì„¸ìŠ¤',
        '/process': 'ì§„í–‰ í”„ë¡œì„¸ìŠ¤',
        '/fund.html': 'ì •ì±…ìê¸ˆ',
        '/fund': 'ì •ì±…ìê¸ˆ',
        '/about.html': 'íšŒì‚¬ ì†Œê°œ',
        '/about': 'íšŒì‚¬ ì†Œê°œ',
        '/post.html': 'ì„±ê³µ ì‚¬ë¡€',
        '/post': 'ì„±ê³µ ì‚¬ë¡€',
        '/marketing.html': 'ë§ˆì¼€íŒ… ìƒë‹´',
        '/marketing': 'ë§ˆì¼€íŒ… ìƒë‹´'
      };
      return map[path] || path;
    }

    // ë¡œë”© í‘œì‹œ
    function showLoading() {
      document.getElementById('stat-visitors').textContent = '-';
      document.getElementById('stat-pageviews').textContent = '-';
      document.getElementById('stat-duration').textContent = '-';
      document.getElementById('stat-bounce').textContent = '-';

      ['stat-visitors-change', 'stat-pageviews-change', 'stat-duration-change', 'stat-bounce-change'].forEach(id => {
        document.getElementById(id).textContent = 'ë¡œë”© ì¤‘...';
        document.getElementById(id).className = 'stat-change';
      });
    }

    // ì—ëŸ¬ í‘œì‹œ
    function showError(message) {
      document.getElementById('period-display').textContent = 'ì˜¤ë¥˜ ë°œìƒ';
      ['stat-visitors', 'stat-pageviews', 'stat-duration', 'stat-bounce'].forEach(id => {
        document.getElementById(id).textContent = '-';
      });
      ['stat-visitors-change', 'stat-pageviews-change', 'stat-duration-change', 'stat-bounce-change'].forEach(id => {
        document.getElementById(id).textContent = message;
        document.getElementById(id).className = 'stat-change negative';
      });
    }

    // ìƒˆë¡œê³ ì¹¨
    function refreshData() {
      const btn = document.querySelector('.refresh-btn');
      btn.classList.add('loading');
      loadAnalyticsData().finally(() => {
        btn.classList.remove('loading');
      });
    }

    // ========== íˆìŠ¤í† ë¦¬ ì„¹ì…˜ ë¡œì§ ==========
    let historyDays = 7;
    let historyChart = null;
    let historyData = null;

    // ì´ˆê¸°í™”ì— íˆìŠ¤í† ë¦¬ ë¡œë“œ ì¶”ê°€
    const originalInit = document.addEventListener;
    document.addEventListener('DOMContentLoaded', function() {
      // ê¸°ì¡´ ì´ˆê¸°í™”ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ (ìœ„ì—ì„œ ì²˜ë¦¬)
      // íˆìŠ¤í† ë¦¬ ê¸°ëŠ¥ ì´ˆê¸°í™”
      initDaysSelector();
      loadHistoryData();
      loadCompareData();
    });

    // ê¸°ê°„ ì„ íƒ ë²„íŠ¼ ì´ˆê¸°í™”
    function initDaysSelector() {
      const btns = document.querySelectorAll('.days-btn');
      btns.forEach(btn => {
        btn.addEventListener('click', function() {
          btns.forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          historyDays = parseInt(this.dataset.days);
          loadHistoryData();
        });
      });
    }

    // íˆìŠ¤í† ë¦¬ ë°ì´í„° ë¡œë“œ
    async function loadHistoryData() {
      try {
        const response = await fetch(`${GA4_API_URL}/history/stats?days=${historyDays}`);
        if (!response.ok) {
          throw new Error('íˆìŠ¤í† ë¦¬ API ìš”ì²­ ì‹¤íŒ¨');
        }
        historyData = await response.json();
        renderHistoryTable(historyData.data || []);
        renderHistoryChart(historyData.data || []);
      } catch (error) {
        console.error('íˆìŠ¤í† ë¦¬ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        renderHistoryTable([]);
        // D1ì— ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° GA4 ì‹¤ì‹œê°„ ë°ì´í„°ë¡œ ëŒ€ì²´
        if (analyticsData && analyticsData.trend) {
          renderHistoryChart(analyticsData.trend.trend || []);
        }
      }
    }

    // ê¸°ê°„ ë¹„êµ ë°ì´í„° ë¡œë“œ (ì¼ê°„/ì£¼ê°„/ì›”ê°„)
    async function loadCompareData() {
      try {
        // ë³‘ë ¬ë¡œ ì¼ê°„/ì£¼ê°„/ì›”ê°„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const [dailyRes, weeklyRes, monthlyRes] = await Promise.all([
          fetch(`${GA4_API_URL}/analytics/overview?period=daily`),
          fetch(`${GA4_API_URL}/analytics/overview?period=weekly`),
          fetch(`${GA4_API_URL}/analytics/overview?period=monthly`)
        ]);

        const [daily, weekly, monthly] = await Promise.all([
          dailyRes.json(),
          weeklyRes.json(),
          monthlyRes.json()
        ]);

        renderCompareCard('compare-daily', daily, 'ì–´ì œ');
        renderCompareCard('compare-weekly', weekly, 'ì§€ë‚œ ì£¼');
        renderCompareCard('compare-monthly', monthly, 'ì§€ë‚œ ë‹¬');
      } catch (error) {
        console.error('ë¹„êµ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    // ë¹„êµ ì¹´ë“œ ë Œë”ë§
    function renderCompareCard(elementId, data, prevLabel) {
      const el = document.getElementById(elementId);
      if (!data || !data.visitors) {
        el.innerHTML = '<div class="compare-row"><span class="compare-label">ë°ì´í„° ì—†ìŒ</span></div>';
        return;
      }

      const rows = [
        { label: 'ë°©ë¬¸ì', current: data.visitors.value, change: data.visitors.change, unit: 'ëª…' },
        { label: 'í˜ì´ì§€ë·°', current: data.pageviews.value, change: data.pageviews.change, unit: 'íšŒ' },
        { label: 'ì²´ë¥˜ì‹œê°„', current: data.duration.value, change: data.duration.change, unit: '' },
        { label: 'ì´íƒˆë¥ ', current: data.bounceRate.value + '%', change: data.bounceRate.change, unit: '', reverse: true }
      ];

      el.innerHTML = rows.map(row => {
        const isPositive = row.reverse ? row.change < 0 : row.change > 0;
        const changeClass = isPositive ? 'positive' : 'negative';
        const sign = row.change >= 0 ? '+' : '';
        return `
          <div class="compare-row">
            <span class="compare-label">${row.label}</span>
            <div class="compare-values">
              <span class="compare-current">${typeof row.current === 'number' ? row.current.toLocaleString() : row.current}${row.unit}</span>
              <span class="compare-change ${changeClass}">${sign}${row.change}%</span>
            </div>
          </div>
        `;
      }).join('');
    }

    // íˆìŠ¤í† ë¦¬ í…Œì´ë¸” ë Œë”ë§
    function renderHistoryTable(data) {
      const tbody = document.getElementById('history-table-body');

      if (!data || data.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="5" class="table-empty">
              ì €ì¥ëœ íˆìŠ¤í† ë¦¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.<br>
              <small style="color:var(--neutral-400)">"ë°ì´í„° ìˆ˜ì§‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì–´ì œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì„¸ìš”.</small>
            </td>
          </tr>
        `;
        return;
      }

      // ìµœì‹  ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬
      const sortedData = [...data].sort((a, b) => b.date.localeCompare(a.date));

      tbody.innerHTML = sortedData.map(row => {
        const duration = row.avg_duration ? formatDuration(row.avg_duration) : '-';
        const bounceRate = row.bounce_rate ? Math.round(row.bounce_rate * 100) + '%' : '-';
        return `
          <tr>
            <td>${formatHistoryDate(row.date)}</td>
            <td class="table-value">${row.visitors?.toLocaleString() || 0}ëª…</td>
            <td class="table-value">${row.pageviews?.toLocaleString() || 0}íšŒ</td>
            <td>${duration}</td>
            <td>${bounceRate}</td>
          </tr>
        `;
      }).join('');
    }

    // íˆìŠ¤í† ë¦¬ ì°¨íŠ¸ ë Œë”ë§
    function renderHistoryChart(data) {
      const ctx = document.getElementById('historyChart').getContext('2d');

      if (historyChart) {
        historyChart.destroy();
      }

      if (!data || data.length === 0) {
        // ë°ì´í„° ì—†ì„ ë•Œ ë¹ˆ ì°¨íŠ¸
        historyChart = new Chart(ctx, {
          type: 'line',
          data: { labels: [], datasets: [] },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: { enabled: false }
            }
          }
        });
        return;
      }

      // ë‚ ì§œìˆœ ì •ë ¬
      const sortedData = [...data].sort((a, b) => {
        const dateA = a.date || '';
        const dateB = b.date || '';
        return dateA.localeCompare(dateB);
      });

      const labels = sortedData.map(d => formatHistoryChartDate(d.date));
      const visitors = sortedData.map(d => d.visitors || 0);
      const pageviews = sortedData.map(d => d.pageviews || 0);

      historyChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'ë°©ë¬¸ì',
              data: visitors,
              borderColor: '#0066CC',
              backgroundColor: 'rgba(0, 102, 204, 0.1)',
              fill: true,
              tension: 0.3,
              borderWidth: 2,
              pointRadius: historyDays <= 14 ? 4 : 2,
              pointHoverRadius: 6
            },
            {
              label: 'í˜ì´ì§€ë·°',
              data: pageviews,
              borderColor: '#10B981',
              backgroundColor: 'transparent',
              tension: 0.3,
              borderWidth: 2,
              pointRadius: historyDays <= 14 ? 4 : 2,
              pointHoverRadius: 6
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false
          },
          plugins: {
            legend: {
              display: true,
              position: 'top',
              align: 'end',
              labels: { boxWidth: 12, padding: 16, font: { size: 11 } }
            },
            tooltip: {
              backgroundColor: 'white',
              titleColor: '#1F2937',
              bodyColor: '#4B5563',
              borderColor: '#E5E7EB',
              borderWidth: 1,
              padding: 12
            }
          },
          scales: {
            x: {
              grid: { display: false },
              ticks: {
                font: { size: 10 },
                maxTicksLimit: historyDays <= 14 ? 7 : 10
              }
            },
            y: {
              beginAtZero: true,
              grid: { color: '#F3F4F6' },
              ticks: { font: { size: 11 } }
            }
          }
        }
      });
    }

    // ìˆ˜ë™ ë°ì´í„° ìˆ˜ì§‘
    async function collectHistoryData() {
      const btn = document.getElementById('collect-btn');
      btn.disabled = true;
      btn.innerHTML = `
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation:spin 1s linear infinite">
          <path d="M23 4v6h-6M1 20v-6h6"/>
          <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
        </svg>
        ìˆ˜ì§‘ ì¤‘...
      `;

      try {
        const response = await fetch(`${GA4_API_URL}/history/collect`);
        const result = await response.json();

        if (result.success) {
          alert(`âœ… ${result.date} ë°ì´í„°ê°€ ìˆ˜ì§‘ë˜ì—ˆìŠµë‹ˆë‹¤.`);
          loadHistoryData();
        } else {
          alert('âŒ ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
        }
      } catch (error) {
        console.error('ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨:', error);
        alert('âŒ ë°ì´í„° ìˆ˜ì§‘ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      } finally {
        btn.disabled = false;
        btn.innerHTML = `
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
          </svg>
          ë°ì´í„° ìˆ˜ì§‘
        `;
      }
    }

    // ìœ í‹¸ë¦¬í‹°: ì²´ë¥˜ì‹œê°„ í¬ë§·
    function formatDuration(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.round(seconds % 60);
      return `${mins}ë¶„ ${secs}ì´ˆ`;
    }

    // ìœ í‹¸ë¦¬í‹°: íˆìŠ¤í† ë¦¬ ë‚ ì§œ í¬ë§· (í…Œì´ë¸”ìš©)
    function formatHistoryDate(dateStr) {
      if (!dateStr) return '-';
      // YYYY-MM-DD í˜•ì‹
      const year = dateStr.substring(0, 4);
      const month = dateStr.substring(5, 7);
      const day = dateStr.substring(8, 10);
      const date = new Date(year, parseInt(month) - 1, day);
      const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
      return `${month}.${day} (${dayNames[date.getDay()]})`;
    }

    // ìœ í‹¸ë¦¬í‹°: íˆìŠ¤í† ë¦¬ ë‚ ì§œ í¬ë§· (ì°¨íŠ¸ìš©)
    function formatHistoryChartDate(dateStr) {
      if (!dateStr) return '';
      const month = dateStr.substring(5, 7);
      const day = dateStr.substring(8, 10);
      return `${parseInt(month)}/${parseInt(day)}`;
    }
  </script>
</body>
</html>
